# tox (https://tox.readthedocs.io/) is a tool for running tests
# in multiple virtualenvs. This configuration file will run the
# test suite on all supported python versions. To use it, "pip install tox"
# and then run "tox" from this directory.

#	Expects both python 3.6 and 3.7 to be installed (Use pyenv)
#	Obscure error messages with 'tox -e py36-numpy' but not 
#   'tox -e py37-numpy' (or vice versa) may be due to python versions not
# 	being avaliable. 

# FIXME: Make sure CPU/GPU gets tested (When GPU avalibale)



[tox]
envlist = 
	# NOTE: NO SPACES!!!
	# Tensorflow currently removed because tests taking too long.
	# Should be two versions of python
	{py36,py37}-{numpy,tensorflow}
	lint
	typecheck
	coverage
	docs
	doctest



# == Defaults for all enviroments ==
[testenv]
setenv = 
	numpy:       QUANTUMFLOW_BACKEND=numpy
	tensorflow: QUANTUMFLOW_BACKEND=tensorflow

deps = 
	-rrequirements.txt
	-rextra-requirements.txt

commands =
	tensorflow: pip install tensorflow -U
	python -m quantumflow.meta
	pytest tests/



# ==== Test Coverage ====
# Note: Skips backends because inactive backends can't get 100% coverage
[testenv:coverage]
setenv = 
	QUANTUMFLOW_BACKEND=numpy

commands = 
	pytest --cov=quantumflow --cov-config .toxcoveragerc --cov-fail-under 100  --cov-report term-missing tests/


# ==== Linting ====
[testenv:lint]

commands =
	flake8 quantumflow examples tests tools setup.py



# == Typecheck ==

[testenv:typecheck]

commands =
	mypy -p quantumflow --ignore-missing-imports



# == Docs ==
[testenv:docs]
commands =
	pip install guzzle_sphinx_theme
	sphinx-build -M html docs docs/_build


[testenv:doctest]
setenv = 
	QUANTUMFLOW_BACKEND=numpy
	
commands =
	python -m quantumflow.meta
	pip install guzzle_sphinx_theme
	sphinx-build -M doctest docs docs/_build


[flake8]
max-line-length = 99
ignore = E226,E302,E41,E402,E241,W503,E123,E741